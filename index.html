<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Formulario</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    select, input, button { padding: 5px; margin-top: 5px; }
  </style>
</head>
<body>
  <h2>Registro</h2>

  <form id="registroForm">
    <label>Subproyecto:
      <select id="subproyectoSelect" required></select>
    </label>

    <label>Rol:
      <select id="rolSelect" required></select>
    </label>

    <label>#:
      <input type="number" id="numero" required>
    </label>

    <label>Unitario:
      <input type="number" step="0.01" id="unitario" required>
    </label>

    <button type="submit">Guardar</button>
  </form>

  <script>
    // üîπ Pega aqu√≠ tu URL del WebApp de Apps Script
    const API_URL = "https://script.google.com/macros/s/AKfycbx7.../exec";

    // üîπ Cargar roles y subproyectos en una sola llamada
    window.onload = async () => {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();

        if (data.status === "ok") {
          // Poblar subproyectos
          const subSel = document.getElementById("subproyectoSelect");
          subSel.innerHTML = "<option value=''>Seleccione...</option>";
          data.subproyectos.forEach(sp => {
            const option = document.createElement("option");
            option.value = sp;
            option.textContent = sp;
            subSel.appendChild(option);
          });

          // Poblar roles
          const rolSel = document.getElementById("rolSelect");
          rolSel.innerHTML = "<option value=''>Seleccione...</option>";
          data.roles.forEach(r => {
            const option = document.createElement("option");
            option.value = r;
            option.textContent = r;
            rolSel.appendChild(option);
          });
        } else {
          alert("‚ùå Error en datos iniciales");
        }
      } catch (err) {
        console.error("Error al cargar datos iniciales", err);
        alert("‚ùå No se pudieron cargar datos iniciales");
      }
    };

    // üîπ Enviar formulario
    document.getElementById("registroForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const payload = {
        subproyecto: document.getElementById("subproyectoSelect").value,
        rol: document.getElementById("rolSelect").value,
        num: document.getElementById("numero").value,
        unitario: document.getElementById("unitario").value
      };

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();

        if (data.status === "ok") {
          alert("‚úÖ " + data.message);
          document.getElementById("registroForm").reset();
        } else {
          alert("‚ùå Error al guardar: " + data.message);
        }
      } catch (err) {
        console.error("Error al guardar", err);
        alert("‚ùå No se pudo guardar");
      }
    });
  </script>
</body>
</html>
